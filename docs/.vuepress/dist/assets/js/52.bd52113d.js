(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{291:function(t,a,s){"use strict";s.r(a);var e=s(28),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"apiplatform"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apiplatform"}},[t._v("#")]),t._v(" ApiPlatform")]),t._v(" "),s("h2",{attrs:{id:"generalites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#generalites"}},[t._v("#")]),t._v(" Généralités")]),t._v(" "),s("ul",[s("li",[t._v("2 contextes : sérialisation et désérialisation\n"),s("ul",[s("li",[t._v("Serialize:\n"),s("ol",[s("li",[t._v("Normalize: PHP Object -> PHP Array")]),t._v(" "),s("li",[t._v("Encode: PHP Array -> Format (JSON, XML)")])])]),t._v(" "),s("li",[t._v("Deserialize:\n"),s("ol",[s("li",[t._v("Decode: Format (JSON, XML) -> PHP Array")]),t._v(" "),s("li",[t._v("Denormalize: PHP Array -> PHP Object")])])])])])]),t._v(" "),s("h2",{attrs:{id:"installation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[t._v("#")]),t._v(" Installation")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("composer require api")]),t._v(" Depuis un projet Symfony existant")])]),t._v(" "),s("h2",{attrs:{id:"fonctionnement"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fonctionnement"}},[t._v("#")]),t._v(" Fonctionnement")]),t._v(" "),s("ul",[s("li",[t._v("Event dispatcher "),s("code",[t._v("Symfony\\Component\\EventDispatcher\\EventDispatcher")]),t._v(" :\n"),s("ul",[s("li",[t._v("Fichier "),s("code",[t._v("vendor/symfony/event-dispatcher/EventDispatcher.php")]),t._v(".")]),t._v(" "),s("li",[t._v("Les listeners sont appelés dans "),s("code",[t._v("EventDispatcher::doDispatch()")]),t._v(" :\n"),s("ul",[s("li",[s("blockquote",[s("p",[t._v("@deprecated since Symfony 4.3, use callListeners() instead")])])]),t._v(" "),s("li",[t._v("Pour être réellement appelés par "),s("code",[t._v("WrappedListener::__invoke()")]),t._v(" ici :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("optimizedListener")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("listener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$eventName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$dispatcher")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])])])])])]),t._v(" "),s("h2",{attrs:{id:"en-tetes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#en-tetes"}},[t._v("#")]),t._v(" En-têtes")]),t._v(" "),s("ul",[s("li",[t._v("Reqûetes\n"),s("ul",[s("li",[s("code",[t._v("Accept")]),t._v(" "),s("code",[t._v("application/json")]),t._v(" pour récupérer uniquement les données brutes (sans hypermédias)")]),t._v(" "),s("li",[s("code",[t._v("Accept")]),t._v(" "),s("code",[t._v("application/ld+json")]),t._v(" pour récupérer les données avec hypermédias (par défaut)")])])])]),t._v(" "),s("h2",{attrs:{id:"configuration-via-des-annotations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-via-des-annotations"}},[t._v("#")]),t._v(" Configuration via des annotations")]),t._v(" "),s("ul",[s("li",[t._v("Généralités\n"),s("ul",[s("li",[t._v("3 niveaux de configuration :\n"),s("ol",[s("li",[t._v("Le fichier de configuration api_platform.yaml donne des configurations pour toutes nos ressources")]),t._v(" "),s("li",[t._v("L'annotation @ApiResource() permet de configurer au cas par cas nos ressources")]),t._v(" "),s("li",[t._v("Les paramètres qu'on passe à une requête HTTP peuvent encore préciser certaines choses")])])]),t._v(" "),s("li",[t._v("La configuration générale se situe dans le fichier "),s("code",[t._v("/config/packages/api_platform.yaml")]),t._v(".")]),t._v(" "),s("li",[t._v("L'annotation "),s("code",[t._v("@ApiResource()")]),t._v(" permet de modifier la configuration au cas par cas. Les paramètres à modifier deviennent une suite de termes reliés par des "),s("code",[t._v("_")]),t._v(" en guise de clé :\n"),s("blockquote",[s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('/**\n * @ApiResource(\n *     attributes={\n *          "pagination_enabled"=true\n *     }\n * )\n */\n')])])]),s("p",[t._v("va modifier le paramètre "),s("code",[t._v("pagination: enabled: true")]),t._v(" du fichier de configuration")])])])])]),t._v(" "),s("li",[t._v("Pagination\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/pagination/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Pagination automatique par défaut. Renvoie 30 items par page par défaut.")]),t._v(" "),s("li",[t._v("Configuration via "),s("code",[t._v("/config/packages/api_platform.yaml")]),t._v(" :"),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("api_platform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("collection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pagination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Désactive la pagination pour toutes les ressources")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("items_per_page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Indique combien d'items par page")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client_enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Permet aux clients de l'API d'activer ou de désactiver la pagination via un paramètre dans l'URL (par défaut ?pagination=true)")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client_items_per_page")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Permet aux clients de l'API de modifier le nombre d'items par page via un paramètre dans l'URL (par défaut ?itemsPerPage=10)")]),t._v("\n")])])])])])]),t._v(" "),s("li",[t._v("Ordre d'apparition des attributs des ressources\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/default-order/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Exemple :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* @ApiResource(\n*     attributes={\n*          "order": {"sentAt": "desc"}\n*     }\n* )\n*/')]),t._v("\n")])])])])])]),t._v(" "),s("li",[t._v("Filtrer et ordonner\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/filters/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("L'annotation "),s("code",[t._v("@ApiFilter")]),t._v(" permet de filtrer ou d'ordonner :\n"),s("ul",[s("li",[s("code",[t._v("SearchFilter")]),t._v(" avec 3 attributs et 2 stratégies de filtrage (utilisable avec le paramètre "),s("code",[t._v("?nomAttribut=valeurCible")]),t._v(") :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* @ApiFilter(\n*     SearchFilter::class,\n*     properties={"firstName": "start", "lastName": "partial", "company", "user.firstName": "exact"}\n* )\n*/')]),t._v("\n")])])])]),t._v(" "),s("li",[s("code",[t._v("OrderFilter")]),t._v(" avec ou sans l'attribut "),s("code",[t._v("properties")]),t._v(" (utilisable avec le paramètre "),s("code",[t._v("?order[nomAttribut]=desc")]),t._v(" ou "),s("code",[t._v("asc")]),t._v(") :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* @ApiFilter(\n*     OrderFilter::class,\n*     properties={"amount", "sentAt"}\n* )\n*/')]),t._v("\n")])])])])])]),t._v(" "),s("li",[t._v("Créer un filtre custom :\n"),s("ul",[s("li",[t._v("Uniquement pour les collections.")]),t._v(" "),s("li",[t._v("Créer une classe dans "),s("code",[t._v("src/Filter")]),t._v(" qui implémente "),s("code",[t._v("ApiPlatform\\Core\\Api\\FilterInterface")]),t._v(" :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterInterface")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * Gets the description of this filter for the given resource.\n    *\n    * Returns an array with the filter parameter names as keys and array with the following data as values:\n    *   - property: the property where the filter is applied\n    *   - type: the type of the filter\n    *   - required: if this filter is required\n    *   - strategy (optional): the used strategy\n    *   - is_collection (optional): is this filter is collection\n    *   - swagger (optional): additional parameters for the path operation,\n    *     e.g. 'swagger' => [\n    *       'description' => 'My Description',\n    *       'name' => 'My Name',\n    *       'type' => 'integer',\n    *     ]\n    *   - openapi (optional): additional parameters for the path operation in the version 3 spec,\n    *     e.g. 'openapi' => [\n    *       'description' => 'My Description',\n    *       'name' => 'My Name',\n    *       'schema' => [\n    *          'type' => 'integer',\n    *       ]\n    *     ]\n    * The description can contain additional data specific to a filter.\n    *\n    * @see \\ApiPlatform\\Core\\Swagger\\Serializer\\DocumentationNormalizer::getFiltersParameters\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDescription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("string "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$resourceClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("On peut aussi accéder aux paramètres de la requête en héritant de "),s("code",[t._v("SearchFilter")]),t._v(" et en surchargeant la méthode "),s("code",[t._v("apply")]),t._v(" :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("QueryBuilder "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$queryBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" QueryNameGeneratorInterface "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$queryNameGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$resourceClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$operationName")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$context")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$propertiesToLookFor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'filters'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("parent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$queryBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$queryNameGenerator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$resourceClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$operationName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])])]),t._v(" "),s("li",[t._v("Groupes de sérialisation\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/serialization/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://symfony.com/doc/current/components/serializer.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc composant serializer de Symfony"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Normalisation :\n"),s("ul",[s("li",[t._v("Groupes de sérialisation :\n"),s("blockquote",[s("p",[t._v("Il est conseillé de mettre tous les attributs d'une entité dans un groupe pour pouvoir facilement choisir lesquels afficher par la suite.")])]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("ApiPlatform"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ApiResource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("Symfony"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Groups")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* // ...\n* @ApiResource(\n*     normalizationContext={\n*          "groups"={"customers_read"}\n*     }\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Customer")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n    * // ...\n    * @Groups(\n    *     {"customers_read", "invoices_read"}\n    * ) // Ici l\'id apparaîtra dans le cadre de la normalisation des Customer et des Invoice.\n    */')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ..")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n    * Get the sum of the customer\'s invoices\n    *\n    * @Groups({"customers_read"}) // La méthode sera appelée pendant la normalisation. On parle de champs calculé.\n    * @return float\n    */')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalAmount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" float "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Le résultat de cette méthode apparaîtra dans un attribut JSON "getTotalAmount"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("array_reduce")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("invoices")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toArray")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$total")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$total")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoice")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAmount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])]),t._v(" "),s("li",[t._v("Dénormalisation :\n"),s("ul",[s("li",[t._v("Désactiver la vérification du types des données en entrée :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("ApiPlatform"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ApiResource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* // ...\n* @ApiResource(\n*     denormalizationContext={\n*          "disable_type_enforcement"=true // Désactive la vérification du types des données en entrée\n*     }\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Invoice")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAmount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$amount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" self "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// On ne spécifie pas de type pour l'attribut $amount")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("amount")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$amount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])])]),t._v(" "),s("li",[t._v("Opérations\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/operations/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("2 types d'opération :\n"),s("ul",[s("li",[t._v("les "),s("em",[t._v("Collection operations")]),t._v(" dont l'url ne recquiert pas d'identifiant ("),s("code",[t._v("/customers")]),t._v(") :\n"),s("ul",[s("li",[t._v("GET (obtenir la liste)")]),t._v(" "),s("li",[t._v("POST (ajouter à la liste)")])])]),t._v(" "),s("li",[t._v("les "),s("em",[t._v("Item operations")]),t._v(" dont l'url requiert un identifiant ("),s("code",[t._v("/customers/{id}")]),t._v(") :\n"),s("ul",[s("li",[t._v("GET (obtenir un élément)")]),t._v(" "),s("li",[t._v("PUT (remplacer)")]),t._v(" "),s("li",[t._v("PATCH (mettre à jour un élément)")]),t._v(" "),s("li",[t._v("DELETE (supprimer un élément)")])])])])]),t._v(" "),s("li",[t._v("Autoriser certaines opérations :\n"),s("blockquote",[s("p",[t._v("L'ordre d'écriture des opérations dans le docblock est celui utilisé pour l'affichage dans la doc swagger sur /api")])]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* @ORM\\Entity(repositoryClass="App\\Repository\\CustomerRepository")\n* @ApiResource(\n*     collectionOperations={"GET", "POST"},\n*     itemOperations={"GET", "DELETE", "PUT", "PATCH"}\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Customer")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("Modifier l'url pour certaines opérations :\n"),s("blockquote",[s("p",[t._v("Ici on veut /clients plutôt que /customers")])]),t._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* @ORM\\Entity(repositoryClass="App\\Repository\\CustomerRepository")\n* @ApiResource(\n*     collectionOperations={"GET"={"path"="/clients"}, "POST"},\n*     itemOperations={"GET"={"path"="/clients/{id}"}, "DELETE", "PUT", "PATCH"}\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Customer")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("Créer ses propres opérations et modifier la doc\n"),s("ol",[s("li",[t._v("Créer un contrôleur chargé de l'opération :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Controller")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Entity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Invoice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Repository"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("InvoiceRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InvoiceIncrementationController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * @var InvoiceRepository\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoiceRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__construct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("InvoiceRepository "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoiceRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("invoiceRepository")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoiceRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("__invoke")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Invoice "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Méthode appelée par notre opération maison. Le paramètre doit être nommé data.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("invoiceRepository")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("incrementAmount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("Modifier l'annotation "),s("code",[t._v("@ApiResource")]),t._v(" en ajoutant l'opération maison (ici "),s("em",[t._v("increment")]),t._v(") :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* @ApiResource(\n*     itemOperations={\n*          "GET", "PUT", "DELETE", "PATCH", "increment"={\n*              "method"="post",\n*              "path"="/invoices/{id}/increment",\n*              "controller"="App\\Controller\\InvoiceIncrementationController",\n*              "openapi_context"={\n*                  "summary"="Increment the amount of an invoice.",\n*                  "description"="Increment the amount of an invoice. It\'s just to show how to make custom operations."\n*              }\n*          }\n*     }\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Invoice")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])])]),t._v(" "),s("li",[t._v("Sous-ressources\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/subresources/#subresources",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Accessible via une url de type "),s("code",[t._v("/nomEntitésPrincipales/{id}/nomSousRessources")]),t._v(" en ajoutant l'annotation "),s("code",[t._v("@ApiSubresource()")]),t._v(" à un attribut :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Customer")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * ...\n    * @ApiSubresource()\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("Configurable au niveau de l'annotation "),s("code",[t._v("@ApiSubresource()")]),t._v(" de la classe :\n"),s("ul",[s("li",[t._v("Au niveau de la classe principale pour des paramètres comme l'uri :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* // ...\n* @ApiResource(\n*     subresourceOperations={\n*          "invoices_get_subresource"={"path"="/clients/{id}/factures"}\n*     }\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Customer")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * ...\n    * @ApiSubresource()\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("Au niveau de la sous-ressource pour les groupes de normalisation :"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n* // ...\n* @ApiResource(\n*     subresourceOperations={\n*          "api_customers_invoices_get_subresource"={\n*              "normalization_context"={\n*                  "groups"={"invoices_subresource"}\n*              }\n*          }\n*     }\n* )\n*/')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Invoice")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * ...\n    * @ApiSubresource()\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$invoices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])])]),t._v(" "),s("li",[t._v("Validation\n"),s("ul",[s("li",[t._v("Comme pour un projet Symfony classique avec les annotations "),s("code",[t._v("@Assert\\")]),t._v(" : "),s("a",{attrs:{href:"https://symfony.com/doc/current/reference/constraints.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1),t._v(".")])])]),t._v(" "),s("li",[t._v("Authentification\n"),s("ul",[s("li",[t._v("JWT avec le "),s("a",{attrs:{href:"https://github.com/lexik/LexikJWTAuthenticationBundle/blob/master/Resources/doc/index.md#getting-started",target:"_blank",rel:"noopener noreferrer"}},[t._v("LexikJWTAuthenticationBundle"),s("OutboundLink")],1),t._v(" : "),s("a",{attrs:{href:"https://api-platform.com/docs/core/jwt/#jwt-authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1),t._v(" "),s("ul",[s("li",[t._v("Exemple de firewalls dans le fichier "),s("code",[t._v("security.yaml")]),t._v(" :"),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("firewalls")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dev")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ^/(_(profiler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("wdt)"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("images"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("js)/\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("security")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Firewall utilisé lors de la création d'un utilisateur")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("registration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ^/api/users\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anonymous")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stateless")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("methods")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("POST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Firewall utilisé pour obtenir un JWT")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  ^/api/login\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stateless")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anonymous")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("json_login")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("check_path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("               /api/login_check\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("success_handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("          lexik_jwt_authentication.handler.authentication_success\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("failure_handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("          lexik_jwt_authentication.handler.authentication_failure\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Firewall pour protéger notre API")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("api")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pattern")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   ^/api\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stateless")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anonymous")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Mettre à false si on veut tout bloquer, mais mieux vaut utiliser l'access_control plus bas")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("guard")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authenticators")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" lexik_jwt_authentication.jwt_token_authenticator\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("anonymous")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lazy\n\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access_control")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ^/api/login"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IS_AUTHENTICATED_ANONYMOUSLY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ^/api/customers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IS_AUTHENTICATED_FULLY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ^/api/invoices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IS_AUTHENTICATED_FULLY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ^/api/users"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" IS_AUTHENTICATED_FULLY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("methods")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" PUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DELETE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])])]),t._v(" "),s("li",[t._v("Agir sur les entités pendant les opérations POST, PUT, PATCH ou DELETE avec les "),s("strong",[t._v("Data Persisters")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/data-persisters/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)])])]),t._v(" "),s("li",[t._v("Utiliser les événements\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/events/#the-event-system",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)])])]),t._v(" "),s("li",[t._v("Modifier les requêtes Doctrine :\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://api-platform.com/docs/core/extensions/",target:"_blank",rel:"noopener noreferrer"}},[t._v("doc"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Pour les collections : Faire une classe qui implémente "),s("code",[t._v("ApiPlatform\\Core\\Bridge\\Doctrine\\Orm\\Extension\\QueryCollectionExtensionInterface")]),t._v(".")]),t._v(" "),s("li",[t._v("Pour les items : Faire une classe qui implémente "),s("code",[t._v("ApiPlatform\\Core\\Bridge\\Doctrine\\Orm\\Extension\\QueryItemExtensionInterface")]),t._v(".")]),t._v(" "),s("li",[t._v("Si pas d'autoconfiguration, modifier le fichier "),s("code",[t._v("/api/config/services.yaml")]),t._v(" :"),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ...")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("'App\\Doctrine\\CurrentUserExtension'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api_platform.doctrine.orm.query_extension.collection "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api_platform.doctrine.orm.query_extension.item "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])]),t._v(" "),s("h2",{attrs:{id:"configuration-via-des-fichiers-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-via-des-fichiers-yaml"}},[t._v("#")]),t._v(" Configuration via des fichiers .yaml")]),t._v(" "),s("ul",[s("li",[t._v("Limiter la profondeur de sérialization à 1 :\n"),s("ul",[s("li",[t._v("Fichier "),s("code",[t._v("/config/packages/api_platform/Company.yaml")]),t._v(":"),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("App\\Entity\\Company")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("attributes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("normalization_context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable_max_depth")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("Entité "),s("code",[t._v("App\\Entity\\Company")]),t._v(":"),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[t._v("Symfony"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("MaxDepth")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Company")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n    * @MaxDepth(1)\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$grantedCompanies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);